#!/bin/bash
# root/.chezmoiscripts/run_once_before_25-install-mise.sh.tmpl
# mise インストール（Ubuntu/Linux用）

set -eu

{{ if .use_homebrew -}}
# Homebrew環境ではスキップ（brew経由でインストール）
echo "=== Skipping mise (will be installed via Homebrew) ==="
exit 0
{{ end -}}

{{ if not .is_ubuntu -}}
# Ubuntu以外ではスキップ
echo "=== Skipping mise (Ubuntu only) ==="
exit 0
{{ end -}}

echo "=== Installing mise ==="

if command -v mise &>/dev/null; then
    echo "✓ mise is already installed"
    mise --version
else
    echo "Installing mise via official installer..."
    curl https://mise.run | sh

    # バイナリをコピー（シンボリックリンクだと root 以外がアクセスできない）
    if [[ -f ~/.local/bin/mise ]]; then
        cp ~/.local/bin/mise /usr/local/bin/mise
        chmod +x /usr/local/bin/mise
    fi

    echo "✓ mise installed successfully"
    mise --version
fi

echo "=== mise installation complete ==="
